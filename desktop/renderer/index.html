<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Security-Policy"
          content="default-src 'self'; connect-src 'self' http://127.0.0.1:18789 ws://127.0.0.1:18789; style-src 'self' 'unsafe-inline'; script-src 'self'" />
    <title>Rovot</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Backend connecting overlay -->
    <div id="backend-status-overlay" class="overlay">
      <div class="onboard-card status-card">
        <div id="backend-connecting">
          <div class="status-spinner"></div>
          <h2>Connecting to backend...</h2>
          <p>Waiting for the Rovot daemon to start.</p>
        </div>
        <div id="backend-error" class="hidden">
          <div class="status-icon-error">&#10007;</div>
          <h2>Backend unavailable</h2>
          <p>Could not reach the Rovot daemon at 127.0.0.1:18789. Make sure it is running.</p>
          <button id="backend-retry" class="btn primary">Retry</button>
        </div>
      </div>
    </div>

    <!-- Onboarding overlay -->
    <div id="onboarding" class="overlay hidden">
      <div class="onboard-card">
        <!-- Step indicators -->
        <div class="onboard-steps">
          <span class="step-dot active" data-step="0"></span>
          <span class="step-dot" data-step="1"></span>
          <span class="step-dot" data-step="2"></span>
          <span class="step-dot" data-step="3"></span>
        </div>

        <!-- Step 0: Compute mode -->
        <div class="onboard-page active" data-page="0">
          <h2>Welcome to Rovot</h2>
          <p>Choose how the AI model runs.</p>
          <div class="option-cards">
            <label class="option-card selected">
              <input type="radio" name="compute" value="local" checked />
              <strong>Local only</strong>
              <span>Use a model server on your machine (LM Studio, Ollama, vLLM).</span>
            </label>
            <label class="option-card">
              <input type="radio" name="compute" value="api" />
              <strong>Remote API key</strong>
              <span>Use a cloud-hosted OpenAI-compatible endpoint.</span>
            </label>
          </div>
          <div id="api-key-section" class="hidden">
            <label>API base URL
              <input id="onboard-api-url" type="text" placeholder="https://api.example.com/v1" />
            </label>
            <label>API key (stored in OS keychain)
              <input id="onboard-api-key" type="password" placeholder="sk-..." />
            </label>
          </div>
          <button class="btn primary" data-next="1">Continue</button>
        </div>

        <!-- Step 1: Model detection -->
        <div class="onboard-page" data-page="1">
          <h2>Detect models</h2>
          <p>Scanning local model servers...</p>
          <div id="model-probe-results" class="probe-list">
            <div class="probe-item scanning">
              <span class="probe-label">LM Studio (localhost:1234)</span>
              <span class="probe-status">scanning...</span>
            </div>
            <div class="probe-item scanning">
              <span class="probe-label">Ollama (localhost:11434)</span>
              <span class="probe-status">scanning...</span>
            </div>
          </div>
          <div class="btn-row">
            <button class="btn secondary" data-prev="0">Back</button>
            <button class="btn primary" data-next="2">Continue</button>
          </div>
        </div>

        <!-- Step 2: Workspace -->
        <div class="onboard-page" data-page="2">
          <h2>Workspace</h2>
          <p>Rovot restricts file access to a workspace directory.</p>
          <label>Workspace path
            <input id="onboard-workspace" type="text" placeholder="~/rovot-workspace" />
          </label>
          <div class="info-box">Only files inside this directory can be read or written by the agent.</div>
          <div class="btn-row">
            <button class="btn secondary" data-prev="1">Back</button>
            <button class="btn primary" data-next="3">Continue</button>
          </div>
        </div>

        <!-- Step 3: Connectors -->
        <div class="onboard-page" data-page="3">
          <h2>Connectors</h2>
          <p>Choose which integrations to enable.</p>
          <div class="toggle-list">
            <label class="toggle-row">
              <input type="checkbox" id="onboard-fs" checked />
              <div>
                <strong>Filesystem</strong>
                <span>Read and write files in your workspace</span>
              </div>
            </label>
            <label class="toggle-row">
              <input type="checkbox" id="onboard-email" />
              <div>
                <strong>Email (IMAP/SMTP)</strong>
                <span>Read inbox and send emails (requires approval)</span>
              </div>
            </label>
            <label class="toggle-row">
              <input type="checkbox" id="onboard-calendar" disabled />
              <div>
                <strong>Calendar</strong>
                <span class="muted">Coming soon</span>
              </div>
            </label>
            <label class="toggle-row">
              <input type="checkbox" id="onboard-messaging" disabled />
              <div>
                <strong>Messaging</strong>
                <span class="muted">Coming soon</span>
              </div>
            </label>
          </div>
          <div class="btn-row">
            <button class="btn secondary" data-prev="2">Back</button>
            <button class="btn primary" id="onboard-finish">Get started</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main app shell -->
    <div id="app-shell">
      <!-- Top bar -->
      <header id="topbar">
        <div class="topbar-left">
          <span class="app-name">Rovot</span>
        </div>
        <div class="topbar-right">
          <span id="model-indicator" class="indicator" title="Active model">--</span>
          <span id="privacy-indicator" class="indicator privacy-local" title="Privacy mode">Local</span>
          <span id="connection-status" class="indicator">connecting...</span>
        </div>
      </header>

      <div id="layout">
        <!-- Sidebar -->
        <nav id="sidebar">
          <button class="nav-item active" data-view="chat">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
            <span>Chat</span>
          </button>
          <button class="nav-item" data-view="models">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
            <span>Models</span>
          </button>
          <button class="nav-item" data-view="connectors">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
            <span>Connectors</span>
          </button>
          <button class="nav-item" data-view="security">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            <span>Security</span>
          </button>
          <button class="nav-item" data-view="logs">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
            <span>Logs</span>
          </button>
        </nav>

        <!-- Content views -->
        <main id="content">
          <!-- Chat view -->
          <section id="view-chat" class="view active">
            <div class="chat-layout">
              <div class="chat-main">
                <div class="chat-header">
                  <button id="new-chat" class="btn secondary btn-sm" title="Start a new conversation">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    New chat
                  </button>
                </div>
                <div id="messages"></div>
                <div id="approvals"></div>
                <div id="composer">
                  <textarea id="input" placeholder="Type a message... (Enter to send, Shift+Enter for newline)"></textarea>
                  <div class="composer-actions">
                    <button id="record" class="btn icon" title="Push to talk">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
                    </button>
                    <button id="send" class="btn primary">Send</button>
                  </div>
                </div>
              </div>
              <aside id="activity-timeline" class="timeline-panel">
                <div class="timeline-header">
                  <h3>Activity</h3>
                  <button id="toggle-timeline" class="btn icon btn-sm" title="Toggle timeline">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
                  </button>
                </div>
                <div id="timeline-events" class="timeline-events"></div>
              </aside>
            </div>
          </section>

          <!-- Models view -->
          <section id="view-models" class="view">
            <div class="view-inner">
              <h2>Models</h2>
              <div class="settings-group">
                <h3>Active configuration</h3>
                <label>Base URL
                  <input id="model-base-url" type="text" placeholder="http://localhost:1234/v1" />
                </label>
                <label>Model name
                  <input id="model-name" type="text" placeholder="(auto-detected or manual)" />
                </label>
                <button id="save-model-config" class="btn primary">Save</button>
              </div>
              <div class="settings-group">
                <h3>Detected servers</h3>
                <div id="detected-models" class="probe-list"></div>
                <button id="rescan-models" class="btn secondary" style="margin-top:10px">Rescan</button>
              </div>
            </div>
          </section>

          <!-- Connectors view -->
          <section id="view-connectors" class="view">
            <div class="view-inner">
              <h2>Connectors</h2>
              <div id="connectors-list" class="toggle-list"></div>
            </div>
          </section>

          <!-- Security view -->
          <section id="view-security" class="view">
            <div class="view-inner">
              <h2>Security</h2>
              <div class="settings-group">
                <h3>Daemon binding</h3>
                <div id="sec-binding" class="info-box">--</div>
              </div>
              <div class="settings-group">
                <h3>Sandbox mode</h3>
                <div id="sec-sandbox" class="info-box">--</div>
              </div>
              <div class="settings-group">
                <h3>Workspace</h3>
                <div id="sec-workspace" class="info-box">--</div>
              </div>
              <div class="settings-group">
                <h3>Auth token</h3>
                <div id="sec-token" class="info-box">Token file present</div>
              </div>
              <div class="settings-group">
                <h3>Secret storage</h3>
                <div id="sec-keychain" class="info-box">--</div>
                <label class="toggle-row connector-toggle sec-toggle">
                  <input type="checkbox" id="sec-keychain-toggle" />
                  <div>
                    <strong>Use OS Keychain</strong>
                    <span>Store secrets in the macOS Keychain / Windows Credential Locker instead of a local file</span>
                  </div>
                </label>
              </div>
              <div class="settings-group">
                <h3>Allowed domains (web.fetch)</h3>
                <div id="sec-domains" class="info-box">--</div>
              </div>
              <div class="settings-group">
                <h3>Connector permissions</h3>
                <div id="sec-connectors" class="info-box">--</div>
              </div>
            </div>
          </section>

          <!-- Logs view -->
          <section id="view-logs" class="view">
            <div class="view-inner">
              <h2>Activity log</h2>
              <div class="log-controls">
                <button id="refresh-logs" class="btn secondary">Refresh</button>
              </div>
              <div id="log-entries" class="log-list"></div>
            </div>
          </section>
        </main>
      </div>
    </div>

    <script src="renderer.js"></script>
  </body>
</html>
